<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  

  
  <title>Git 多平台换行符问题(LF or CRLF) | 他山笨石</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="12$ git add .fatal: CRLF would be replaced by LF ...  文本文件所使用的换行符，在不同的系统平台上是不一样的。UNIX/Linux 使用的是 0x0A（LF），早期的 Mac OS 使用的是 0x0D（CR），后来的 OS X 在更换内核后与 UNIX 保持一致了。但 DOS/Windows 一直使用 0x0D0A（CRLF） 作为换行符。 跨平">
<meta property="og:type" content="article">
<meta property="og:title" content="Git 多平台换行符问题(LF or CRLF)">
<meta property="og:url" content="http://yoursite.com/2019/04/24/git-lf-crlf/index.html">
<meta property="og:site_name" content="他山笨石">
<meta property="og:description" content="12$ git add .fatal: CRLF would be replaced by LF ...  文本文件所使用的换行符，在不同的系统平台上是不一样的。UNIX/Linux 使用的是 0x0A（LF），早期的 Mac OS 使用的是 0x0D（CR），后来的 OS X 在更换内核后与 UNIX 保持一致了。但 DOS/Windows 一直使用 0x0D0A（CRLF） 作为换行符。 跨平">
<meta property="og:locale" content="default">
<meta property="og:image" content="https://wx1.sinaimg.cn/mw690/c3c88275ly1fdsav3d6yjj20hs0d5afx.jpg">
<meta property="og:image" content="https://camo.githubusercontent.com/c334a5644f69da294255a1de0a690239f8a83131/68747470733a2f2f662e636c6f75642e6769746875622e636f6d2f6173736574732f313233313335392f3937343134392f64396564313662652d303634622d313165332d393336382d3831373138616563653335322e706e67">
<meta property="og:image" content="https://camo.githubusercontent.com/47791095c618944f5838aa21b4cb6a7db5e6efb5/68747470733a2f2f662e636c6f75642e6769746875622e636f6d2f6173736574732f313233313335392f3937343135342f66363163353066322d303634622d313165332d393530362d3366343238393066336331392e706e67">
<meta property="og:image" content="https://camo.githubusercontent.com/8d6a7962aba0ce4e94ec32e4bf788360a84b301f/68747470733a2f2f662e636c6f75642e6769746875622e636f6d2f6173736574732f313233313335392f3937343136322f31363930353264342d303634632d313165332d393434352d3535656637303238623633632e706e67">
<meta property="og:image" content="https://camo.githubusercontent.com/6ffa4da0e063d96bd53efa07156b4322db46f483/68747470733a2f2f662e636c6f75642e6769746875622e636f6d2f6173736574732f313233313335392f3937343136332f31666261353632302d303634632d313165332d396438612d6236653665653764333761322e706e67">
<meta property="og:updated_time" content="2019-04-25T15:27:26.674Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Git 多平台换行符问题(LF or CRLF)">
<meta name="twitter:description" content="12$ git add .fatal: CRLF would be replaced by LF ...  文本文件所使用的换行符，在不同的系统平台上是不一样的。UNIX/Linux 使用的是 0x0A（LF），早期的 Mac OS 使用的是 0x0D（CR），后来的 OS X 在更换内核后与 UNIX 保持一致了。但 DOS/Windows 一直使用 0x0D0A（CRLF） 作为换行符。 跨平">
<meta name="twitter:image" content="https://wx1.sinaimg.cn/mw690/c3c88275ly1fdsav3d6yjj20hs0d5afx.jpg">
  
    <link rel="alternate" href="/atom.xml" title="他山笨石" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">他山笨石</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-git-lf-crlf" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/24/git-lf-crlf/" class="article-date">
  <time datetime="2019-04-23T16:06:23.000Z" itemprop="datePublished">2019-04-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Git 多平台换行符问题(LF or CRLF)
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git add .</span><br><span class="line">fatal: CRLF would be replaced by LF ...</span><br></pre></td></tr></table></figure>
<p><img src="https://wx1.sinaimg.cn/mw690/c3c88275ly1fdsav3d6yjj20hs0d5afx.jpg" alt></p>
<p><strong>文本文件所使用的换行符，在不同的系统平台上是不一样的</strong>。UNIX/Linux 使用的是 <code>0x0A（LF）</code>，早期的 Mac OS 使用的是 <code>0x0D（CR）</code>，后来的 OS X 在更换内核后与 UNIX 保持一致了。但 DOS/Windows 一直使用 <code>0x0D0A（CRLF）</code> 作为换行符。</p>
<p>跨平台协作开发是常有的，不统一的换行符确实对跨平台的文件交换带来了麻烦。最大的问题是，在不同平台上，换行符发生改变时，Git 会认为整个文件被修改，这就造成我们没法 <code>diff</code>，不能正确反映本次的修改。还好 Git 在设计时就考虑了这一点，其提供了一个 <code>autocrlf</code> 的配置项，用于在提交和检出时自动转换换行符，该配置有三个可选项：</p>
<ul>
<li><strong>true:</strong> 提交时转换为 LF，检出时转换为 CRLF</li>
<li><strong>false:</strong> 提交检出均不转换</li>
<li><strong>input:</strong> 提交时转换为LF，检出时不转换</li>
</ul>
<p>用如下命令即可完成配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 提交时转换为LF，检出时转换为CRLF</span><br><span class="line">git config --global core.autocrlf true</span><br><span class="line"></span><br><span class="line"># 提交时转换为LF，检出时不转换</span><br><span class="line">git config --global core.autocrlf input</span><br><span class="line"></span><br><span class="line"># 提交检出均不转换</span><br><span class="line">git config --global core.autocrlf false</span><br></pre></td></tr></table></figure>
<p>如果把 autocrlf 设置为 false 时，那另一个配置项 <code>safecrlf</code> 最好设置为 <strong>ture</strong>。该选项用于检查文件是否包含混合换行符，其有三个可选项：</p>
<ul>
<li><strong>true:</strong> 拒绝提交包含混合换行符的文件</li>
<li><strong>false:</strong> 允许提交包含混合换行符的文件</li>
<li><strong>warn:</strong> 提交包含混合换行符的文件时给出警告</li>
</ul>
<p>配置方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 拒绝提交包含混合换行符的文件</span><br><span class="line">git config --global core.safecrlf true</span><br><span class="line"></span><br><span class="line"># 允许提交包含混合换行符的文件</span><br><span class="line">git config --global core.safecrlf false</span><br><span class="line"></span><br><span class="line"># 提交包含混合换行符的文件时给出警告</span><br><span class="line">git config --global core.safecrlf warn</span><br></pre></td></tr></table></figure>
<p>到此，还并未解决我遇到的问题。实际上，我们有两种办法解决。</p>
<p>一种是将配置项改为如下的形式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global core.autocrlf false</span><br><span class="line">$ git config --global core.safecrlf false</span><br></pre></td></tr></table></figure>
<p>这种方式是不推荐的，虽然代码能被提交，但是项目中的文件可能会包含两种格式的换行符。而且会有如上提到的问题，文件被视为整个被修改，无法 diff，之所以使用版本控制工具，最重要的原因之一就是其 diff 功能。</p>
<p>另一种办法是，手动将文件的换行符转化为 LF，这可以通过编辑器来完成，大部分编辑器都可以将文件的换行符风格设置为 unix 的形式。也可以使用 <code>dos2unix</code> 转换工具来完成，Windows 上 Git bash 客户端自带了该工具。其他系统上也可以安装该工具，例如 Ubuntu 上安装：</p>
<blockquote>
<p>sudo apt-get install dos2unix</p>
</blockquote>
<p>有了该工具，可以批量的把项目中的文件都转化一遍：</p>
<blockquote>
<p>find . -type f | xargs dos2unix</p>
</blockquote>
<p>或者</p>
<blockquote>
<p>find . -type f -exec dos2unix {} +</p>
</blockquote>
<p>如果涉及到在多个系统平台上工作，推荐将 git 做如下配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global core.autocrlf input</span><br><span class="line">$ git config --global core.safecrlf true</span><br></pre></td></tr></table></figure>
<p>也就是让代码仓库使用统一的换行符(LF)，如果代码中包含 CRLF 类型的文件时将无法提交，需要用 <code>dos2unix</code> 或者其他工具手动转换文件类型。当然，可以根据自己的需要进行更为合适的配置！</p>
<h2 id="防范"><a href="#防范" class="headerlink" title="防范"></a>防范</h2><p>首先，不要着急去整 Git，先整好自己。你的团队需要确立一个统一的换行符标准（推荐使用 UNIX 风格）。然后，团队的成员们需要分头做好准备工作——配置好自己的代码编辑器和 IDE，达到这两项要求：</p>
<ul>
<li>在新建文件时默认使用团队统一的换行符标准</li>
<li>在打开文件时保持现有换行符格式不变（即不做自动转换）</li>
</ul>
<p>这样一方面可以最大程度保证项目代码的规范一致，另一方面，即使现有代码中遗留了一些不规范的情况，也不会因为反复转换而导致混乱。（当然，作为一个强迫症患者，我还是祝愿所有的项目从一开始就步入严谨有序的轨道。）</p>
<p>接下来，我们就可以开始调教 Git 了。我的建议是， <strong>完全关掉这个自作聪明的“换行符自动转换”功能</strong>。关闭之后，Git 就不会对你的换行符做任何手脚了，你可以完全自主地、可预期地控制自己的换行符风格。</p>
<p>下面主要针对不同的 Git 客户端，分别介绍一下操作方法。</p>
<h3 id="Git-for-Windows"><a href="#Git-for-Windows" class="headerlink" title="Git for Windows"></a>Git for Windows</h3><p>这货由 Git 官方出品，在安装时就会向你兜售“换行符自动转换”功能，估计大多数人在看完华丽丽的功能介绍之后会毫不犹豫地选择第一项（自动转换）。请千万抵挡住诱惑，选择最后一项（不做任何手脚）。</p>
<p><a href="https://camo.githubusercontent.com/c334a5644f69da294255a1de0a690239f8a83131/68747470733a2f2f662e636c6f75642e6769746875622e636f6d2f6173736574732f313233313335392f3937343134392f64396564313662652d303634622d313165332d393336382d3831373138616563653335322e706e67" target="_blank" rel="noopener"><img src="https://camo.githubusercontent.com/c334a5644f69da294255a1de0a690239f8a83131/68747470733a2f2f662e636c6f75642e6769746875622e636f6d2f6173736574732f313233313335392f3937343134392f64396564313662652d303634622d313165332d393336382d3831373138616563653335322e706e67" alt="first-trap-on-github-autocrlf-git-install"></a></p>
<p>如果你已经做出了错误的选择，也不需要重新安装，可以直接使用命令行来修改设置。很简单，直接打开这货自带的命令行工具 Git Bash，输入以下命令，再敲回车即可：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global core.autocrlf false</span><br></pre></td></tr></table></figure>
<p><a href="https://camo.githubusercontent.com/47791095c618944f5838aa21b4cb6a7db5e6efb5/68747470733a2f2f662e636c6f75642e6769746875622e636f6d2f6173736574732f313233313335392f3937343135342f66363163353066322d303634622d313165332d393530362d3366343238393066336331392e706e67" target="_blank" rel="noopener"><img src="https://camo.githubusercontent.com/47791095c618944f5838aa21b4cb6a7db5e6efb5/68747470733a2f2f662e636c6f75642e6769746875622e636f6d2f6173736574732f313233313335392f3937343135342f66363163353066322d303634622d313165332d393530362d3366343238393066336331392e706e67" alt="first-trap-on-github-autocrlf-bash"></a></p>
<h3 id="TortoiseGit"><a href="#TortoiseGit" class="headerlink" title="TortoiseGit"></a>TortoiseGit</h3><p>很多从 TortoiseSVN 走过来的同学很可能会选用 TortoiseGit 作为主力客户端，那么也需要配置一下。在 Windows 资源管理器窗口中点击右键，选择“TortoiseGit → Settings → Git”，做如下设置。</p>
<p><a href="https://camo.githubusercontent.com/8d6a7962aba0ce4e94ec32e4bf788360a84b301f/68747470733a2f2f662e636c6f75642e6769746875622e636f6d2f6173736574732f313233313335392f3937343136322f31363930353264342d303634632d313165332d393434352d3535656637303238623633632e706e67" target="_blank" rel="noopener"><img src="https://camo.githubusercontent.com/8d6a7962aba0ce4e94ec32e4bf788360a84b301f/68747470733a2f2f662e636c6f75642e6769746875622e636f6d2f6173736574732f313233313335392f3937343136322f31363930353264342d303634632d313165332d393434352d3535656637303238623633632e706e67" alt="first-trap-on-github-autocrlf-tortoisegit"></a></p>
<p>（由于 TortoiseGit 实际上是基于 Git for Windows 的一个 GUI 外壳，你在上一节所做的设置会影响到上图这些选项的状态，它们可能直接就是你所需要的样子了。）</p>
<h3 id="GitHub-的-Windows-客户端"><a href="#GitHub-的-Windows-客户端" class="headerlink" title="GitHub 的 Windows 客户端"></a>GitHub 的 Windows 客户端</h3><p>它是今天的第二被告。这货很容易上手，很适合小白，我主要用它来一键克隆项目到本地。可能正是为了维护简洁易用的亲切形象，这货并没有像 TortoiseGit 那样提供丰富的选项（对“换行符自动转换”这样的细节功能完全讳莫如深啊，我这样的小白死了都不知道怎么死的……）。因此，我们需要手动修改一下它的配置。</p>
<p>GitHub 的 Windows 客户端实际上也是一个壳，它自带了一个便携版的 Git for Windows。这个便携版和你自己安装的 Git for Windows 是相互独立的，不过它们都会使用同一个配置文件（实际上就是当前用户主目录下的 <code>.gitconfig</code> 文件）。</p>
<p>所以如果你已经配置好了自己安装的 Git for Windows，那就不用操心什么了。但如果你的机器上只装过 GitHub 的 Windows 客户端，那么最简单的配置方法就是手工修改配置文件了。</p>
<h3 id="修改-Git-的全局配置文件"><a href="#修改-Git-的全局配置文件" class="headerlink" title="修改 Git 的全局配置文件"></a>修改 Git 的全局配置文件</h3><p>进入当前用户的主目录（通常 XP 的用户目录是 <code>C:\Documents and Settings\yourname</code>，在 Vista 和 Win7 下是 <code>C:\Users\yourname</code>），用你最顺手的文本编辑器打开 <code>.gitconfig</code> 文件。</p>
<p>在 <code>[core]</code> 区段找到 <code>autocrlf</code>，将它的值改为 <code>false</code>。如果没找到，就在 <code>[core]</code> 区段中新增一行：（最终效果见图）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">autocrlf = false</span><br></pre></td></tr></table></figure>
<p><a href="https://camo.githubusercontent.com/6ffa4da0e063d96bd53efa07156b4322db46f483/68747470733a2f2f662e636c6f75642e6769746875622e636f6d2f6173736574732f313233313335392f3937343136332f31666261353632302d303634632d313165332d396438612d6236653665653764333761322e706e67" target="_blank" rel="noopener"><img src="https://camo.githubusercontent.com/6ffa4da0e063d96bd53efa07156b4322db46f483/68747470733a2f2f662e636c6f75642e6769746875622e636f6d2f6173736574732f313233313335392f3937343136332f31666261353632302d303634632d313165332d396438612d6236653665653764333761322e706e67" alt="first-trap-on-github-autocrlf-gitconfig"></a></p>
<p>事实上上面介绍的所有命令行或图形界面的配置方法，最终效果都是一样的，因为本质上都是在修改这个配置文件。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料:"></a><strong>参考资料:</strong></h2><ul>
<li><a href="https://toub.es/2012/05/28/fatal-crlf-would-be-replaced-lf" target="_blank" rel="noopener">https://toub.es/2012/05/28/fatal-crlf-would-be-replaced-lf</a></li>
<li><a href="https://github.com/cssmagic/blog/issues/22" target="_blank" rel="noopener">https://github.com/cssmagic/blog/issues/22</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/04/24/git-lf-crlf/" data-id="cjzgirkmk000304u2klj1i5qt" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/08/03/resource/commit/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          (no title)
        
      </div>
    </a>
  
  
    <a href="/2019/04/16/windows-php-cgi-timeout/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">windows环境下php-cgi使用curl请求接口阻塞超时的问题</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php/">php</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/php/" style="font-size: 20px;">php</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/08/18/gibberish/">windows程序员常见乱码问题汇总</a>
          </li>
        
          <li>
            <a href="/2019/08/11/vue-route-nginx/">vue-router+nginx 路径配置方法</a>
          </li>
        
          <li>
            <a href="/2019/08/03/http-101/">HTTP基础知识</a>
          </li>
        
          <li>
            <a href="/2019/08/03/resource/commit/">(no title)</a>
          </li>
        
          <li>
            <a href="/2019/04/24/git-lf-crlf/">Git 多平台换行符问题(LF or CRLF)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 Ben Stone<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>