<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Xray教程 | 他山笨石</title>
<meta name="keywords" content="xray">
<meta name="description" content="Xray介绍 一个Debian包维护者发现XTLS库的LICENSE不是BSD许可，提了一个issue希望作者 @rprx 能修改方便打包，详见 https://github.com/XTLS/Go/issues/9 。由这个issue引发了广泛讨论，rprx认为目前许可不是问题，也有不少人认为协议是立场的体现，各执一词。
最终V2ray(V2fly社区)维护者经过投票确认XTLS不符合V2ray的MIT协议，并在V2ray-core 4.33.0版本移除了XTLS。rprx和其拥护者行动起来，很快就创建了Project X项目和Xray子项目（Xray取名来自XTLS和V2ray的结合），并发布了Xray-core的多个版本。这便是Xray的大致由来。
XTLS和Xray离不开作者 @rprx 的辛勤付出，因此也简要介绍一下@rprx ：
@rprx 是VLESS协议的设计者，在介绍VLESS协议时写下了 性能至上、可扩展性空前，目标是全场景终极协议 的宏壮愿景； @rprx 是 XTLS 的作者，在 XTLS库 中写下了 “THE FUTURE” 的霸气描述。将内外两条TLS连接结合，rprx可能不是第一个有这想法的人，但却是第一个将其实现、并成熟应用到实际中的作者。从使用表现上看，XTLS无愧于rprx对其的评价：划时代的革命性概念与技术：XTLS，以及社区给出的“黑科技”称谓； @rprx 是Project X和Xray项目的创始人。由于LICENSE理念之争，rprx创建了对标Project V和V2ray-core的Project X和Xray-core项目，广受欢迎。 Xray-Core自上个月创立以来，短短一个月已经发布了七个版本，足见维护者的诚意。Xray-Core目前发布的各个版本主要介绍如下：
Xray-core 1.0.0版本：项目创建，提供完整的VLESS和XTLS支持，功能上是V2ray-core的超集。主要变动是将v2ray和v2ctl可执行文件合并为xray，性能全面增强； Xray-core 1.1.0和1.1.1版本：测试过渡版本，未提供详细发行说明； Xray-core 1.1.2版本：引入了Linux Kernel Splice技术，适用于安卓、路由器等Linux环境。Splice技术减少了数据拷贝次数和内存占用，拥有更强的性能。需要说明的是，只适用于类Linux环境的客户端出栈，服务端入栈仍然是direct； Xray-core 1.1.3版本：重构了透明代理的 REDIRECT 模式，使之同时支持 IPv4 和 IPv6，解决了V2ray和trojan遗留的问题； Xray-core 1.1.4版本：优化内存占用，TLS更多选项配置，使服务端伪装站的TLS设置在SSL Labs能达到A&#43;评分； Xray-core 1.1.5版本：测试过渡版本，支持YAML配置文件、OCSP Stapling等功能，官方安装脚本大更新； Xray-core 1.2.0版本：SS、trojan协议完美支持Fullcone，向游戏使用迈出了重要一步。 Xray-core 1.2.3版本： 对 SS 协议的支持又变强了, 支持单端口多用户! 对 trojan 协议的支持也又变强了, trojan 的回落也解锁 SNI 分流的新姿势啦~! (VLESS: 嘤嘤嘤) UDP 奇奇怪怪的 BUG 被干掉了, 一个字, “稳定”.">
<meta name="author" content="">
<link rel="canonical" href="https://shiqstone.github.io/post/xray-tutorial/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.91271db59a1cc6d80ca5e764681a680ab708aaa888b53ce09b5af262b9f73e53.css" integrity="sha256-kScdtZocxtgMpedkaBpoCrcIqqiItTzgm1ryYrn3PlM=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://shiqstone.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://shiqstone.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://shiqstone.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://shiqstone.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://shiqstone.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>




<meta property="og:title" content="Xray教程" />
<meta property="og:description" content="Xray介绍 一个Debian包维护者发现XTLS库的LICENSE不是BSD许可，提了一个issue希望作者 @rprx 能修改方便打包，详见 https://github.com/XTLS/Go/issues/9 。由这个issue引发了广泛讨论，rprx认为目前许可不是问题，也有不少人认为协议是立场的体现，各执一词。
最终V2ray(V2fly社区)维护者经过投票确认XTLS不符合V2ray的MIT协议，并在V2ray-core 4.33.0版本移除了XTLS。rprx和其拥护者行动起来，很快就创建了Project X项目和Xray子项目（Xray取名来自XTLS和V2ray的结合），并发布了Xray-core的多个版本。这便是Xray的大致由来。
XTLS和Xray离不开作者 @rprx 的辛勤付出，因此也简要介绍一下@rprx ：
@rprx 是VLESS协议的设计者，在介绍VLESS协议时写下了 性能至上、可扩展性空前，目标是全场景终极协议 的宏壮愿景； @rprx 是 XTLS 的作者，在 XTLS库 中写下了 “THE FUTURE” 的霸气描述。将内外两条TLS连接结合，rprx可能不是第一个有这想法的人，但却是第一个将其实现、并成熟应用到实际中的作者。从使用表现上看，XTLS无愧于rprx对其的评价：划时代的革命性概念与技术：XTLS，以及社区给出的“黑科技”称谓； @rprx 是Project X和Xray项目的创始人。由于LICENSE理念之争，rprx创建了对标Project V和V2ray-core的Project X和Xray-core项目，广受欢迎。 Xray-Core自上个月创立以来，短短一个月已经发布了七个版本，足见维护者的诚意。Xray-Core目前发布的各个版本主要介绍如下：
Xray-core 1.0.0版本：项目创建，提供完整的VLESS和XTLS支持，功能上是V2ray-core的超集。主要变动是将v2ray和v2ctl可执行文件合并为xray，性能全面增强； Xray-core 1.1.0和1.1.1版本：测试过渡版本，未提供详细发行说明； Xray-core 1.1.2版本：引入了Linux Kernel Splice技术，适用于安卓、路由器等Linux环境。Splice技术减少了数据拷贝次数和内存占用，拥有更强的性能。需要说明的是，只适用于类Linux环境的客户端出栈，服务端入栈仍然是direct； Xray-core 1.1.3版本：重构了透明代理的 REDIRECT 模式，使之同时支持 IPv4 和 IPv6，解决了V2ray和trojan遗留的问题； Xray-core 1.1.4版本：优化内存占用，TLS更多选项配置，使服务端伪装站的TLS设置在SSL Labs能达到A&#43;评分； Xray-core 1.1.5版本：测试过渡版本，支持YAML配置文件、OCSP Stapling等功能，官方安装脚本大更新； Xray-core 1.2.0版本：SS、trojan协议完美支持Fullcone，向游戏使用迈出了重要一步。 Xray-core 1.2.3版本： 对 SS 协议的支持又变强了, 支持单端口多用户! 对 trojan 协议的支持也又变强了, trojan 的回落也解锁 SNI 分流的新姿势啦~! (VLESS: 嘤嘤嘤) UDP 奇奇怪怪的 BUG 被干掉了, 一个字, “稳定”." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://shiqstone.github.io/post/xray-tutorial/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-11-11T14:03:08&#43;08:00" />
<meta property="article:modified_time" content="2022-11-11T14:03:08&#43;08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Xray教程"/>
<meta name="twitter:description" content="Xray介绍 一个Debian包维护者发现XTLS库的LICENSE不是BSD许可，提了一个issue希望作者 @rprx 能修改方便打包，详见 https://github.com/XTLS/Go/issues/9 。由这个issue引发了广泛讨论，rprx认为目前许可不是问题，也有不少人认为协议是立场的体现，各执一词。
最终V2ray(V2fly社区)维护者经过投票确认XTLS不符合V2ray的MIT协议，并在V2ray-core 4.33.0版本移除了XTLS。rprx和其拥护者行动起来，很快就创建了Project X项目和Xray子项目（Xray取名来自XTLS和V2ray的结合），并发布了Xray-core的多个版本。这便是Xray的大致由来。
XTLS和Xray离不开作者 @rprx 的辛勤付出，因此也简要介绍一下@rprx ：
@rprx 是VLESS协议的设计者，在介绍VLESS协议时写下了 性能至上、可扩展性空前，目标是全场景终极协议 的宏壮愿景； @rprx 是 XTLS 的作者，在 XTLS库 中写下了 “THE FUTURE” 的霸气描述。将内外两条TLS连接结合，rprx可能不是第一个有这想法的人，但却是第一个将其实现、并成熟应用到实际中的作者。从使用表现上看，XTLS无愧于rprx对其的评价：划时代的革命性概念与技术：XTLS，以及社区给出的“黑科技”称谓； @rprx 是Project X和Xray项目的创始人。由于LICENSE理念之争，rprx创建了对标Project V和V2ray-core的Project X和Xray-core项目，广受欢迎。 Xray-Core自上个月创立以来，短短一个月已经发布了七个版本，足见维护者的诚意。Xray-Core目前发布的各个版本主要介绍如下：
Xray-core 1.0.0版本：项目创建，提供完整的VLESS和XTLS支持，功能上是V2ray-core的超集。主要变动是将v2ray和v2ctl可执行文件合并为xray，性能全面增强； Xray-core 1.1.0和1.1.1版本：测试过渡版本，未提供详细发行说明； Xray-core 1.1.2版本：引入了Linux Kernel Splice技术，适用于安卓、路由器等Linux环境。Splice技术减少了数据拷贝次数和内存占用，拥有更强的性能。需要说明的是，只适用于类Linux环境的客户端出栈，服务端入栈仍然是direct； Xray-core 1.1.3版本：重构了透明代理的 REDIRECT 模式，使之同时支持 IPv4 和 IPv6，解决了V2ray和trojan遗留的问题； Xray-core 1.1.4版本：优化内存占用，TLS更多选项配置，使服务端伪装站的TLS设置在SSL Labs能达到A&#43;评分； Xray-core 1.1.5版本：测试过渡版本，支持YAML配置文件、OCSP Stapling等功能，官方安装脚本大更新； Xray-core 1.2.0版本：SS、trojan协议完美支持Fullcone，向游戏使用迈出了重要一步。 Xray-core 1.2.3版本： 对 SS 协议的支持又变强了, 支持单端口多用户! 对 trojan 协议的支持也又变强了, trojan 的回落也解锁 SNI 分流的新姿势啦~! (VLESS: 嘤嘤嘤) UDP 奇奇怪怪的 BUG 被干掉了, 一个字, “稳定”."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Posts",
      "item": "https://shiqstone.github.io/post/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "Xray教程",
      "item": "https://shiqstone.github.io/post/xray-tutorial/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Xray教程",
  "name": "Xray教程",
  "description": "Xray介绍 一个Debian包维护者发现XTLS库的LICENSE不是BSD许可，提了一个issue希望作者 @rprx 能修改方便打包，详见 https://github.com/XTLS/Go/issues/9 。由这个issue引发了广泛讨论，rprx认为目前许可不是问题，也有不少人认为协议是立场的体现，各执一词。\n最终V2ray(V2fly社区)维护者经过投票确认XTLS不符合V2ray的MIT协议，并在V2ray-core 4.33.0版本移除了XTLS。rprx和其拥护者行动起来，很快就创建了Project X项目和Xray子项目（Xray取名来自XTLS和V2ray的结合），并发布了Xray-core的多个版本。这便是Xray的大致由来。\nXTLS和Xray离不开作者 @rprx 的辛勤付出，因此也简要介绍一下@rprx ：\n@rprx 是VLESS协议的设计者，在介绍VLESS协议时写下了 性能至上、可扩展性空前，目标是全场景终极协议 的宏壮愿景； @rprx 是 XTLS 的作者，在 XTLS库 中写下了 “THE FUTURE” 的霸气描述。将内外两条TLS连接结合，rprx可能不是第一个有这想法的人，但却是第一个将其实现、并成熟应用到实际中的作者。从使用表现上看，XTLS无愧于rprx对其的评价：划时代的革命性概念与技术：XTLS，以及社区给出的“黑科技”称谓； @rprx 是Project X和Xray项目的创始人。由于LICENSE理念之争，rprx创建了对标Project V和V2ray-core的Project X和Xray-core项目，广受欢迎。 Xray-Core自上个月创立以来，短短一个月已经发布了七个版本，足见维护者的诚意。Xray-Core目前发布的各个版本主要介绍如下：\nXray-core 1.0.0版本：项目创建，提供完整的VLESS和XTLS支持，功能上是V2ray-core的超集。主要变动是将v2ray和v2ctl可执行文件合并为xray，性能全面增强； Xray-core 1.1.0和1.1.1版本：测试过渡版本，未提供详细发行说明； Xray-core 1.1.2版本：引入了Linux Kernel Splice技术，适用于安卓、路由器等Linux环境。Splice技术减少了数据拷贝次数和内存占用，拥有更强的性能。需要说明的是，只适用于类Linux环境的客户端出栈，服务端入栈仍然是direct； Xray-core 1.1.3版本：重构了透明代理的 REDIRECT 模式，使之同时支持 IPv4 和 IPv6，解决了V2ray和trojan遗留的问题； Xray-core 1.1.4版本：优化内存占用，TLS更多选项配置，使服务端伪装站的TLS设置在SSL Labs能达到A+评分； Xray-core 1.1.5版本：测试过渡版本，支持YAML配置文件、OCSP Stapling等功能，官方安装脚本大更新； Xray-core 1.2.0版本：SS、trojan协议完美支持Fullcone，向游戏使用迈出了重要一步。 Xray-core 1.2.3版本： 对 SS 协议的支持又变强了, 支持单端口多用户! 对 trojan 协议的支持也又变强了, trojan 的回落也解锁 SNI 分流的新姿势啦~! (VLESS: 嘤嘤嘤) UDP 奇奇怪怪的 BUG 被干掉了, 一个字, “稳定”.",
  "keywords": [
    "xray"
  ],
  "articleBody": "Xray介绍 一个Debian包维护者发现XTLS库的LICENSE不是BSD许可，提了一个issue希望作者 @rprx 能修改方便打包，详见 https://github.com/XTLS/Go/issues/9 。由这个issue引发了广泛讨论，rprx认为目前许可不是问题，也有不少人认为协议是立场的体现，各执一词。\n最终V2ray(V2fly社区)维护者经过投票确认XTLS不符合V2ray的MIT协议，并在V2ray-core 4.33.0版本移除了XTLS。rprx和其拥护者行动起来，很快就创建了Project X项目和Xray子项目（Xray取名来自XTLS和V2ray的结合），并发布了Xray-core的多个版本。这便是Xray的大致由来。\nXTLS和Xray离不开作者 @rprx 的辛勤付出，因此也简要介绍一下@rprx ：\n@rprx 是VLESS协议的设计者，在介绍VLESS协议时写下了 性能至上、可扩展性空前，目标是全场景终极协议 的宏壮愿景； @rprx 是 XTLS 的作者，在 XTLS库 中写下了 “THE FUTURE” 的霸气描述。将内外两条TLS连接结合，rprx可能不是第一个有这想法的人，但却是第一个将其实现、并成熟应用到实际中的作者。从使用表现上看，XTLS无愧于rprx对其的评价：划时代的革命性概念与技术：XTLS，以及社区给出的“黑科技”称谓； @rprx 是Project X和Xray项目的创始人。由于LICENSE理念之争，rprx创建了对标Project V和V2ray-core的Project X和Xray-core项目，广受欢迎。 Xray-Core自上个月创立以来，短短一个月已经发布了七个版本，足见维护者的诚意。Xray-Core目前发布的各个版本主要介绍如下：\nXray-core 1.0.0版本：项目创建，提供完整的VLESS和XTLS支持，功能上是V2ray-core的超集。主要变动是将v2ray和v2ctl可执行文件合并为xray，性能全面增强； Xray-core 1.1.0和1.1.1版本：测试过渡版本，未提供详细发行说明； Xray-core 1.1.2版本：引入了Linux Kernel Splice技术，适用于安卓、路由器等Linux环境。Splice技术减少了数据拷贝次数和内存占用，拥有更强的性能。需要说明的是，只适用于类Linux环境的客户端出栈，服务端入栈仍然是direct； Xray-core 1.1.3版本：重构了透明代理的 REDIRECT 模式，使之同时支持 IPv4 和 IPv6，解决了V2ray和trojan遗留的问题； Xray-core 1.1.4版本：优化内存占用，TLS更多选项配置，使服务端伪装站的TLS设置在SSL Labs能达到A+评分； Xray-core 1.1.5版本：测试过渡版本，支持YAML配置文件、OCSP Stapling等功能，官方安装脚本大更新； Xray-core 1.2.0版本：SS、trojan协议完美支持Fullcone，向游戏使用迈出了重要一步。 Xray-core 1.2.3版本： 对 SS 协议的支持又变强了, 支持单端口多用户! 对 trojan 协议的支持也又变强了, trojan 的回落也解锁 SNI 分流的新姿势啦~! (VLESS: 嘤嘤嘤) UDP 奇奇怪怪的 BUG 被干掉了, 一个字, “稳定”. 嗅探可以排除你不想嗅探的域名, 可以开启一些新玩法. 向发现问题-\u003e开issue-\u003e自行测试-\u003e自行分析-\u003e自行找到问题-\u003e自行解决-\u003e然后给上下游提交PR的大佬 @Bohan Yang 致敬! 更多Xray-core新特性请参考官方说明：https://xtls.github.io/about/new/ ，或者官方库发行说明：https://github.com/XTLS/Xray-core/releases\nXray和V2ray的区别 在说明Xray和V2ray区别之前，先说一下三个相近但不同的概念：\nV2ray：Project V 是用于构建基础通信网络的工具合集，其核心工具称为V2Ray。V2ray主要负责网络协议和功能的实现，既可以单独运行，也可以和其它工具配合。V2ray官网是：https://v2ray.com/，Github项目主页是：https://github.com/v2ray，TG讨论组是：@projectv2ray； V2fly：出现一些科学上网作者被喝茶事件后，V2ray原开发者长期不上线，其他维护者没有完整权限，导致V2ray项目维护困难。因此社区在2019年组建了V2fly组织，继续维护V2ray，也是目前V2ray发展的主力。V2fly官网是：https://www.v2fly.org，Github项目主页是：https://github.com/v2fly，TG通知频道：@v2fly，TG交流群为：@v2fly_chat； Xray：因许可理念之争，VLESS和XTLS的作者单独创建了Xray项目，目前是V2ray的超集，后续可能有不同的发展路线。Xray文档官网（测试中）：https://xtls.github.io/， Github项目主页：https://github.com/XTLS，TG交流群：@projectXray。 从上面可以看到，先有V2ray(Project V)，然后是V2fly，最后才出来Xray(Project X)。其中V2fly是V2ray的社区，可以认为两者是同一个组织。\n详细一点说，Xray和V2ray区别如下：\nXray是V2ray的一个分支(Fork)。Xray项目基于V2ray而来，其支持并且兼容V2ray的配置； Xray是V2ray的超集。虽然最新版V2ray删除了XTLS，但仍保留VLESS协议。Xray提供完整的VLESS和XTLS支持，目前是V2ray的超集，但后续Xray可能会有会有自己的发展方向； 如果使用XTLS，强烈推荐使用Xray，或者安装V2ray-Core 4.29.0 ～ 4.32.1版本；不使用XTLS的情况下，使用V2ray和Xray均可。 一个小提示是，Xray项目创建以来，V2ray没再发布新版本，反而Xray热火朝天，不断出新版和新功能。此外Xray的TG群也非常热闹，每天至少七八K的消息。如果你喜欢尝试新东西和折腾，Xray适合你，否则V2ray也挺好用。 Xray安装和使用教程 和其他自行部署的技术相同，使用Xray分为安装服务端和配置客户端两部分，接下来分别做介绍。\n准备工作 VPS 一台，重置好主流的操作系统 域名一个，解析到该VPS。（域名申请证书，lnmp自带） 自行开启 BBR 加速或者锐速（本站自己找） 需要安装Nginx，修改 Nginx 配置文件 安装xray 自行部署Xray服务端需要你有基本linux技巧，能使用vim/nano等编辑器。官方提供了大多数Linux系统的一键脚本，可以直接使用：\nbash -c \"$(curl -L https://github.com/XTLS/Xray-install/raw/main/install-release.sh)\" @ install 官方脚本安装的文件符合FHS规范，可执行文件xray在 /usr/local/bin 目录下，配置文件位于 /usr/local/etc/xray目录内。\n配置 官方脚本安装的配置文件内容为空，可参考 Xray-examples 中提供的模板编辑配置文件。例如使用VLESS+TCP+XTLS的配置文件为：\n{ \"log\": { \"loglevel\": \"info\" }, \"inbounds\": [ { \"port\": 443, # 可以换成其他端口 \"protocol\": \"vless\", \"settings\": { \"clients\": [ { \"id\": \"\", // 填写UUID，可以使用xray uuid生成 \"flow\": \"xtls-rprx-direct\", \"level\": 0 } ], \"decryption\": \"none\", \"fallbacks\": [ { \"dest\": 80 // 回落配置，可以直接转到其他网站，例如\"www.baidu.com:80\" } ] }, \"streamSettings\": { \"network\": \"tcp\", \"security\": \"xtls\", \"xtlsSettings\": { \"alpn\": [ \"http/1.1\" ], \"certificates\": [ { \"certificateFile\": \"/path/to/fullchain.crt\", // 换成你的证书，绝对路径 \"keyFile\": \"/path/to/private.key\" // 换成你的私钥，绝对路径 } ] } } } ], \"outbounds\": [ { \"protocol\": \"freedom\" } ] } 说明：json文件解析不支持注释，实际使用中需要把所有注释内容删除\nUUID 随机生成代码 cat /proc/sys/kernel/random/uuid # 粘贴到VPS运行即可生成 UUID 启动服务 配置完毕后，可通过以下命令控制服务\nsystemctl start xray 运行 xray， systemctl stop xray 停止xray， systemctl restart xray 重启， systemctl status xray xray运行状态 journalctl -xe --no-pager -u xray 查看运行日志。 Xray客户端 服务端配置好后，接下来是配置客户端。目前有如下客户端支持Xray：\nXray Windows客户端： V2rayN：3.28版本起支持xray，只需要下载Xray-core，将解压的文件放到V2rayN-Core文件夹下即可。需要注意的是V2rayN 4.0版本移除了PAC，改用路由规则，会给习惯了PAC的用户带来困扰。习惯Qv2ray的网友应该乐于接受这个改变； winXray：winXray是Windows系统上简洁稳定的Xray/V2Ray、Shadowsocks、Trojan 通用客户端，可自动检测并连接访问速度最快的 代理服务器。该项目原作者删库后出现了一些同名库，安全性未知，因此本站托管的依然是旧版； Xray安卓客户端： V2rayNG：V2rayNG可以说是最跟随Xray步伐的V2ray客户端了，Xray发布新版本后会在第一时间更新，推荐使用。 Xray Mac客户端： V2rayU：基于v2ray核心的mac版客户端,界面友好,使用swift4.2编写,支持vmess,shadowsocks,socks5等服务协议,支持订阅, 支持二维码,剪贴板导入,手动配置,二维码分享等。 Xray苹果客户端： Shadowrocket/小火箭：小火箭目前是ios系统上更新最频繁的V2ray客户端，价格也不贵，支持多种协议，推荐使用。 VLESS协议的fallback参数介绍 V2ray的VLESS协议 引入了分流和回落的概念，一般情况下建议直接监听443端口。习惯了使用Nginx建站或者流量转发的网友，VLESS协议 fallback方式让人一时难以理解。下面简要介绍V2ray VLESS协议的fallback参数，支持VLESS协议的V2ray客户端请到 V2ray客户端 页面下载。\nVLESS协议的fallback参数 VLESS协议 中的 fallback 是可选的，只能用于TLS或XTLS模式下。其值是一个对象数组，每一个对象格式如下：\n{ \"alpn\": \"\", \"path\": \"\", \"dest\": \"\", \"xver\": \"\" } 四个参数中只有 dest 是必须的，alpn一般不用管（或者填[\"http/1.1\"]），path 是回落路径，xver用来指示是否传递真实ip信息（需要填1，不需要填0）。新手建议先忽略dest外的选项，例如 V2ray的VLESS协议介绍和使用教程 中，fallback的值为：\n\"fallbacks\": [ { \"dest\": 80 // 回落配置，可以直接转到其他网站，例如\"www.baidu.com:80\" } ] 如果有多组转发，则可按照 path 路径配置多组 fallback 对象，例如V2ray官方配置中的 VLESS终极配置 的配置如下：\n\"fallbacks\": [ { \"dest\": 80 // 或者回落到其它也防探测的代理 }, { \"path\": \"/websocket\", // 必须换成自定义的 PATH \"dest\": 1234, \"xver\": 1 }, { \"path\": \"/vmesstcp\", // 必须换成自定义的 PATH \"dest\": 2345, \"xver\": 1 }, { \"path\": \"/vmessws\", // 必须换成自定义的 PATH \"dest\": 3456, \"xver\": 1 } ] 在上述配置中，客户端请求 域名:/websocket 时，流量将转发到本机的1234端口；请求 域名:/vmesstcp 时，流量转发到本机的 2345 端口；请求路径为 /vmessws 时转发到 3456 端口；如果是其他请求，则转到到 80 端口。\n配置VLESS fallback可能遇到的问题 从上面可以看到，VLESS协议 的回落按照 path 区分，和Nginx按照域名区分是不同的。于是新手可能会产生如下问题：\n服务器上多个域名，fallback怎么配置？\nV2ray的VLESS协议 的入栈配置按照 path/alpn等参数选择回落，不能根据域名（SNI）分流。如果要支持多域名共存，请使用如下方案：\nv2ray监听非443端口（例如监听8443），Nginx监听443端口，然后v2ray fallback到Nginx的80端口； Nginx使用stream监听443，然后根据域名SNI分流，流量转到后端网站以及V2ray。 如果你不在意v2ray的流量入口不是443端口，建议使用第一种方案，无需对现在站点配置做改动；否则请选择第二种方案。\n2021.1.15更新：Xray-core 1.2.2版本fallback新增name参数，可填入域名实现SNI分流\nVLESS ALPN问题 如果fallback后端用的Nginx，fallback时会遇到问题。具体为：\n如果V2ray (x)tlsSettings 不指定ALPN，根据测试V2ray只接受HTTP/2协议，流量fallback到后端时将采用的 h2c 协议。此时，后端Nginx必须用h2c的HTTP/2配置才能正常解析请求：\nlisten 80 http2; # h2c协议，无需配置ssl证书 需要注意的是，这种情况下，浏览器用HTTP协议不能正常访问80端口，因为HTTP/2规定必须使用HTTPS。\n为解决上述情形，V2ray (x)tlsSettings可以指定ALPN为HTTP/1.1：\ntlsSettings: { \"serverName\": \"xxx.com\", \"alpn\": [\"http/1.1\"], ... } 如此一来，V2ray将通过HTTP/1.1协议转发流量到Nginx，Nginx常规监听80端口即可，浏览器用HTTP/1.1协议也能直接访问：\nserver { listen 80; ... } 这种配置的问题是不支持更高性能的HTTP/2协议，如果后端是网站，对访客访问速度会有影响。\n对于配合建站的V2ray伪装来说，我们希望流量是正常的，用户能尽快打开网页，同时兼容性也好。在VLESS fallback模式下，即同时支持HTTP/1.1和HTTP/2。要做到如此，则需要用到VLESS fallback中的alpn参数。\n首先，我们要让位于前端的V2ray同时支持HTTP/1.1和HTTP/2：\ntlsSettings: { \"serverName\": \"xxx.com\", \"alpn\": [\"http/1.1\", \"h2\"], ... } 接着，在fallback配置中，根据alpn转发流量到后端：\n\"fallbacks\": [ { \"alpn\": \"http/1.1\", \"dest\": 80 }, { \"alpn\": \"h2\", \"dest\": 81, } ] 最后，配置Nginx同时接收HTTP/1.1和H2C流量：\nserver { listen 80; listen 81 http2; ... } 上述配置将支持所有类型流量，并且普通用户可以通过80端口正常访问网站，V2ray流量伪装做的完美而又隐蔽，是最推荐的。\n",
  "wordCount" : "449",
  "inLanguage": "en",
  "datePublished": "2022-11-11T14:03:08+08:00",
  "dateModified": "2022-11-11T14:03:08+08:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://shiqstone.github.io/post/xray-tutorial/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "他山笨石",
    "logo": {
      "@type": "ImageObject",
      "url": "https://shiqstone.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://shiqstone.github.io" accesskey="h" title="他山笨石 (Alt + H)">他山笨石</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://shiqstone.github.io/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="https://shiqstone.github.io/post/" title="Blog">
                    <span>Blog</span>
                </a>
            </li>
            <li>
                <a href="https://shiqstone.github.io/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      Xray教程<sup><span class="entry-isdraft">&nbsp;&nbsp;[draft]</span></sup>
    </h1>
    <div class="post-meta"><span title='2022-11-11 14:03:08 +0800 CST'>November 11, 2022</span>

</div>
  </header> <aside id="toc-container" class="toc-container wide">
<div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#xray%e4%bb%8b%e7%bb%8d" aria-label="Xray介绍">Xray介绍</a></li>
                <li>
                    <a href="#xray%e5%92%8cv2ray%e7%9a%84%e5%8c%ba%e5%88%ab" aria-label="Xray和V2ray的区别">Xray和V2ray的区别</a></li>
                <li>
                    <a href="#xray%e5%ae%89%e8%a3%85%e5%92%8c%e4%bd%bf%e7%94%a8%e6%95%99%e7%a8%8b" aria-label="Xray安装和使用教程">Xray安装和使用教程</a><ul>
                        
                <li>
                    <a href="#%e5%87%86%e5%a4%87%e5%b7%a5%e4%bd%9c" aria-label="准备工作">准备工作</a></li>
                <li>
                    <a href="#%e5%ae%89%e8%a3%85xray" aria-label="安装xray">安装xray</a></li>
                <li>
                    <a href="#%e9%85%8d%e7%bd%ae" aria-label="配置">配置</a></li>
                <li>
                    <a href="#%e5%90%af%e5%8a%a8%e6%9c%8d%e5%8a%a1" aria-label="启动服务">启动服务</a></li></ul>
                </li>
                <li>
                    <a href="#xray%e5%ae%a2%e6%88%b7%e7%ab%af" aria-label="Xray客户端">Xray客户端</a><ul>
                        
                <li>
                    <a href="#xray-windows%e5%ae%a2%e6%88%b7%e7%ab%af" aria-label="Xray Windows客户端：">Xray Windows客户端：</a></li></ul>
                </li>
                <li>
                    <a href="#xray%e5%ae%89%e5%8d%93%e5%ae%a2%e6%88%b7%e7%ab%af" aria-label="Xray安卓客户端：">Xray安卓客户端：</a></li>
                <li>
                    <a href="#xray-mac%e5%ae%a2%e6%88%b7%e7%ab%af" aria-label="Xray Mac客户端：">Xray Mac客户端：</a></li>
                <li>
                    <a href="#xray%e8%8b%b9%e6%9e%9c%e5%ae%a2%e6%88%b7%e7%ab%af" aria-label="Xray苹果客户端：">Xray苹果客户端：</a></li>
                <li>
                    <a href="#vless%e5%8d%8f%e8%ae%ae%e7%9a%84fallback%e5%8f%82%e6%95%b0%e4%bb%8b%e7%bb%8d" aria-label="VLESS协议的fallback参数介绍">VLESS协议的fallback参数介绍</a><ul>
                        
                <li>
                    <a href="#vless%e5%8d%8f%e8%ae%ae%e7%9a%84fallback%e5%8f%82%e6%95%b0" aria-label="VLESS协议的fallback参数">VLESS协议的fallback参数</a></li>
                <li>
                    <a href="#%e9%85%8d%e7%bd%aevless-fallback%e5%8f%af%e8%83%bd%e9%81%87%e5%88%b0%e7%9a%84%e9%97%ae%e9%a2%98" aria-label="配置VLESS fallback可能遇到的问题">配置VLESS fallback可能遇到的问题</a></li>
                <li>
                    <a href="#vless-alpn%e9%97%ae%e9%a2%98" aria-label="VLESS ALPN问题">VLESS ALPN问题</a>
                </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();
        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
        
        activeElement = elements[0];
        const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
        document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
    }, false);
    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);
    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 && 
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement
        elements.forEach(element => {
            const id = encodeURI(element.getAttribute('id')).toLowerCase();
            if (element === activeElement){
                document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
            } else {
                document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
            }
        })
    }, false);
    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);
    function checkTocPosition() {
        const width = document.body.scrollWidth;
        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }
    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;   
    }
</script>

  <div class="post-content"><h2 id="xray介绍">Xray介绍<a hidden class="anchor" aria-hidden="true" href="#xray介绍">#</a></h2>
<p>一个Debian包维护者发现<a href="https://github.com/XTLS/Go">XTLS</a>库的LICENSE不是BSD许可，提了一个issue希望作者 <a href="https://github.com/rprx">@rprx</a> 能修改方便打包，详见 <a href="https://github.com/XTLS/Go/issues/9">https://github.com/XTLS/Go/issues/9</a> 。由这个issue引发了广泛讨论，rprx认为目前许可不是问题，也有不少人认为协议是立场的体现，各执一词。</p>
<p>最终V2ray(V2fly社区)维护者经过投票确认XTLS不符合V2ray的MIT协议，并在<a href="https://github.com/v2fly/v2ray-core/releases/tag/v4.33.0">V2ray-core 4.33.0版本移除了XTLS</a>。rprx和其拥护者行动起来，很快就创建了<a href="https://github.com/XTLS">Project X项目</a>和<a href="https://github.com/XTLS/Xray-core">Xray子项目</a>（Xray取名来自XTLS和V2ray的结合），并发布了Xray-core的多个版本。这便是Xray的大致由来。</p>
<p>XTLS和Xray离不开作者 @rprx 的辛勤付出，因此也简要介绍一下@rprx ：</p>
<ol>
<li>@rprx 是VLESS协议的设计者，在介绍VLESS协议时写下了 <a href="https://github.com/v2ray/v2ray-core/issues/2636">性能至上、可扩展性空前，目标是全场景终极协议</a> 的宏壮愿景；</li>
<li>@rprx 是 XTLS 的作者，在 XTLS库 中写下了 “THE FUTURE” 的霸气描述。将内外两条TLS连接结合，rprx可能不是第一个有这想法的人，但却是第一个将其实现、并成熟应用到实际中的作者。从使用表现上看，XTLS无愧于rprx对其的评价：划时代的革命性概念与技术：XTLS，以及社区给出的“黑科技”称谓；</li>
<li>@rprx 是Project X和Xray项目的创始人。由于LICENSE理念之争，rprx创建了对标Project V和V2ray-core的Project X和Xray-core项目，广受欢迎。</li>
</ol>
<p>Xray-Core自上个月创立以来，短短一个月已经发布了七个版本，足见维护者的诚意。Xray-Core目前发布的各个版本主要介绍如下：</p>
<ol>
<li>Xray-core 1.0.0版本：项目创建，提供完整的VLESS和XTLS支持，功能上是V2ray-core的超集。主要变动是将v2ray和v2ctl可执行文件合并为xray，性能全面增强；</li>
<li>Xray-core 1.1.0和1.1.1版本：测试过渡版本，未提供详细发行说明；</li>
<li>Xray-core 1.1.2版本：引入了Linux Kernel Splice技术，适用于安卓、路由器等Linux环境。Splice技术减少了数据拷贝次数和内存占用，拥有更强的性能。需要说明的是，只适用于类Linux环境的客户端出栈，服务端入栈仍然是direct；</li>
<li>Xray-core 1.1.3版本：重构了透明代理的 REDIRECT 模式，使之同时支持 IPv4 和 IPv6，解决了V2ray和trojan遗留的问题；</li>
<li>Xray-core 1.1.4版本：优化内存占用，TLS更多选项配置，使服务端伪装站的TLS设置在SSL Labs能达到A+评分；</li>
<li>Xray-core 1.1.5版本：测试过渡版本，支持YAML配置文件、OCSP Stapling等功能，官方安装脚本大更新；</li>
<li>Xray-core 1.2.0版本：SS、trojan协议完美支持Fullcone，向游戏使用迈出了重要一步。</li>
<li>Xray-core 1.2.3版本：</li>
</ol>
<ul>
<li>对 SS 协议的支持又变强了, 支持单端口多用户!</li>
<li>对 trojan 协议的支持也又变强了, trojan 的回落也解锁 SNI 分流的新姿势啦~!</li>
<li>(VLESS: 嘤嘤嘤)</li>
<li>UDP 奇奇怪怪的 BUG 被干掉了, 一个字, “稳定”.</li>
<li>嗅探可以排除你不想嗅探的域名, 可以开启一些新玩法.</li>
<li>向发现问题-&gt;开issue-&gt;自行测试-&gt;自行分析-&gt;自行找到问题-&gt;自行解决-&gt;然后给上下游提交PR的大佬  @Bohan Yang 致敬!</li>
</ul>
<p>更多Xray-core新特性请参考官方说明：https://xtls.github.io/about/new/ ，或者官方库发行说明：https://github.com/XTLS/Xray-core/releases</p>
<h2 id="xray和v2ray的区别">Xray和V2ray的区别<a hidden class="anchor" aria-hidden="true" href="#xray和v2ray的区别">#</a></h2>
<p>在说明Xray和V2ray区别之前，先说一下三个相近但不同的概念：</p>
<ul>
<li><strong>V2ray</strong>：Project V 是用于构建基础通信网络的工具合集，其核心工具称为V2Ray。V2ray主要负责网络协议和功能的实现，既可以单独运行，也可以和其它工具配合。V2ray官网是：https://v2ray.com/，Github项目主页是：https://github.com/v2ray，TG讨论组是：@projectv2ray；</li>
<li><strong>V2fly</strong>：出现一些科学上网作者被喝茶事件后，V2ray原开发者长期不上线，其他维护者没有完整权限，导致V2ray项目维护困难。因此社区在2019年组建了V2fly组织，继续维护V2ray，也是目前V2ray发展的主力。V2fly官网是：https://www.v2fly.org，Github项目主页是：https://github.com/v2fly，TG通知频道：@v2fly，TG交流群为：@v2fly_chat；</li>
<li><strong>Xray</strong>：因许可理念之争，VLESS和XTLS的作者单独创建了Xray项目，目前是V2ray的超集，后续可能有不同的发展路线。Xray文档官网（测试中）：https://xtls.github.io/， Github项目主页：https://github.com/XTLS，TG交流群：@projectXray。</li>
</ul>
<p>从上面可以看到，先有V2ray(Project V)，然后是V2fly，最后才出来Xray(Project X)。其中V2fly是V2ray的社区，可以认为两者是同一个组织。</p>
<p>详细一点说，Xray和V2ray区别如下：</p>
<ol>
<li><strong>Xray是V2ray的一个分支(Fork)</strong>。Xray项目基于V2ray而来，其支持并且兼容V2ray的配置；</li>
<li><strong>Xray是V2ray的超集</strong>。虽然最新版V2ray删除了XTLS，但仍保留VLESS协议。Xray提供完整的VLESS和XTLS支持，目前是V2ray的超集，但后续Xray可能会有会有自己的发展方向；</li>
<li><strong>如果使用XTLS，强烈推荐使用Xray</strong>，或者安装V2ray-Core 4.29.0 ～ 4.32.1版本；不使用XTLS的情况下，使用V2ray和Xray均可。
一个小提示是，Xray项目创建以来，V2ray没再发布新版本，反而Xray热火朝天，不断出新版和新功能。此外Xray的TG群也非常热闹，每天至少七八K的消息。如果你喜欢尝试新东西和折腾，Xray适合你，否则V2ray也挺好用。</li>
</ol>
<h2 id="xray安装和使用教程">Xray安装和使用教程<a hidden class="anchor" aria-hidden="true" href="#xray安装和使用教程">#</a></h2>
<p>和其他自行部署的技术相同，使用Xray分为安装服务端和配置客户端两部分，接下来分别做介绍。</p>
<h3 id="准备工作">准备工作<a hidden class="anchor" aria-hidden="true" href="#准备工作">#</a></h3>
<ol>
<li>VPS 一台，重置好主流的操作系统</li>
<li>域名一个，解析到该VPS。（域名申请证书，lnmp自带）</li>
<li>自行开启 BBR 加速或者锐速（本站自己找）</li>
<li>需要安装Nginx，修改 Nginx 配置文件</li>
</ol>
<h3 id="安装xray">安装xray<a hidden class="anchor" aria-hidden="true" href="#安装xray">#</a></h3>
<p>自行部署Xray服务端需要你有基本linux技巧，能使用vim/nano等编辑器。官方提供了大多数Linux系统的<a href="https://github.com/XTLS/Xray-install">一键脚本</a>，可以直接使用：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>bash -c <span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>curl -L https://github.com/XTLS/Xray-install/raw/main/install-release.sh<span style="color:#66d9ef">)</span><span style="color:#e6db74">&#34;</span> @ install
</span></span></code></pre></div><p>官方脚本安装的文件符合<a href="https://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard">FHS规范</a>，可执行文件xray在 <code>/usr/local/bin</code> 目录下，配置文件位于 <code>/usr/local/etc/xray</code>目录内。</p>
<h3 id="配置">配置<a hidden class="anchor" aria-hidden="true" href="#配置">#</a></h3>
<p>官方脚本安装的配置文件内容为空，可参考 <a href="https://github.com/XTLS/Xray-examples">Xray-examples</a> 中提供的模板编辑配置文件。例如使用VLESS+TCP+XTLS的配置文件为：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;log&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;loglevel&#34;</span>: <span style="color:#e6db74">&#34;info&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;inbounds&#34;</span>: [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;port&#34;</span>: <span style="color:#ae81ff">443</span>, <span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#960050;background-color:#1e0010">可以换成其他端口</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;protocol&#34;</span>: <span style="color:#e6db74">&#34;vless&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;settings&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;clients&#34;</span>: [
</span></span><span style="display:flex;"><span>                    {
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#75715e">// 填写UUID，可以使用xray uuid生成
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                        <span style="color:#f92672">&#34;flow&#34;</span>: <span style="color:#e6db74">&#34;xtls-rprx-direct&#34;</span>,
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;level&#34;</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                ],
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;decryption&#34;</span>: <span style="color:#e6db74">&#34;none&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;fallbacks&#34;</span>: [
</span></span><span style="display:flex;"><span>                    {
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;dest&#34;</span>: <span style="color:#ae81ff">80</span> <span style="color:#75715e">// 回落配置，可以直接转到其他网站，例如&#34;www.baidu.com:80&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                    }
</span></span><span style="display:flex;"><span>                ]
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;streamSettings&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;network&#34;</span>: <span style="color:#e6db74">&#34;tcp&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;security&#34;</span>: <span style="color:#e6db74">&#34;xtls&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;xtlsSettings&#34;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;alpn&#34;</span>: [
</span></span><span style="display:flex;"><span>                        <span style="color:#e6db74">&#34;http/1.1&#34;</span>
</span></span><span style="display:flex;"><span>                    ],
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;certificates&#34;</span>: [
</span></span><span style="display:flex;"><span>                        {
</span></span><span style="display:flex;"><span>                            <span style="color:#f92672">&#34;certificateFile&#34;</span>: <span style="color:#e6db74">&#34;/path/to/fullchain.crt&#34;</span>, <span style="color:#75715e">// 换成你的证书，绝对路径
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                            <span style="color:#f92672">&#34;keyFile&#34;</span>: <span style="color:#e6db74">&#34;/path/to/private.key&#34;</span> <span style="color:#75715e">// 换成你的私钥，绝对路径
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                        }
</span></span><span style="display:flex;"><span>                    ]
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;outbounds&#34;</span>: [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;protocol&#34;</span>: <span style="color:#e6db74">&#34;freedom&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><strong>说明：json文件解析不支持注释，实际使用中需要把所有注释内容删除</strong></p>
<ul>
<li>UUID 随机生成代码
<pre tabindex="0"><code>cat /proc/sys/kernel/random/uuid # 粘贴到VPS运行即可生成 UUID
</code></pre></li>
</ul>
<h3 id="启动服务">启动服务<a hidden class="anchor" aria-hidden="true" href="#启动服务">#</a></h3>
<p>配置完毕后，可通过以下命令控制服务</p>
<ul>
<li><code>systemctl start xray</code> 运行 xray，</li>
<li><code>systemctl stop xray</code> 停止xray，</li>
<li><code>systemctl restart xray</code> 重启，</li>
<li><code>systemctl status xray</code> xray运行状态</li>
<li><code>journalctl -xe --no-pager -u xray</code> 查看运行日志。</li>
</ul>
<h2 id="xray客户端">Xray客户端<a hidden class="anchor" aria-hidden="true" href="#xray客户端">#</a></h2>
<p>服务端配置好后，接下来是配置客户端。目前有如下客户端支持Xray：</p>
<h3 id="xray-windows客户端">Xray Windows客户端：<a hidden class="anchor" aria-hidden="true" href="#xray-windows客户端">#</a></h3>
<ul>
<li>V2rayN：3.28版本起支持xray，只需要下载Xray-core，将解压的文件放到V2rayN-Core文件夹下即可。需要注意的是V2rayN 4.0版本移除了PAC，改用路由规则，会给习惯了PAC的用户带来困扰。习惯Qv2ray的网友应该乐于接受这个改变；</li>
<li>winXray：winXray是Windows系统上简洁稳定的Xray/V2Ray、Shadowsocks、Trojan 通用客户端，可自动检测并连接访问速度最快的 代理服务器。该项目原作者删库后出现了一些同名库，安全性未知，因此本站托管的依然是旧版；</li>
</ul>
<h2 id="xray安卓客户端">Xray安卓客户端：<a hidden class="anchor" aria-hidden="true" href="#xray安卓客户端">#</a></h2>
<ul>
<li>V2rayNG：V2rayNG可以说是最跟随Xray步伐的V2ray客户端了，Xray发布新版本后会在第一时间更新，推荐使用。</li>
</ul>
<h2 id="xray-mac客户端">Xray Mac客户端：<a hidden class="anchor" aria-hidden="true" href="#xray-mac客户端">#</a></h2>
<ul>
<li>V2rayU：基于v2ray核心的mac版客户端,界面友好,使用swift4.2编写,支持vmess,shadowsocks,socks5等服务协议,支持订阅, 支持二维码,剪贴板导入,手动配置,二维码分享等。</li>
</ul>
<h2 id="xray苹果客户端">Xray苹果客户端：<a hidden class="anchor" aria-hidden="true" href="#xray苹果客户端">#</a></h2>
<ul>
<li>Shadowrocket/小火箭：小火箭目前是ios系统上更新最频繁的V2ray客户端，价格也不贵，支持多种协议，推荐使用。</li>
</ul>
<h2 id="vless协议的fallback参数介绍">VLESS协议的fallback参数介绍<a hidden class="anchor" aria-hidden="true" href="#vless协议的fallback参数介绍">#</a></h2>
<p>V2ray的VLESS协议 引入了分流和回落的概念，一般情况下建议直接监听443端口。习惯了使用Nginx建站或者流量转发的网友，VLESS协议 fallback方式让人一时难以理解。下面简要介绍V2ray VLESS协议的fallback参数，支持VLESS协议的V2ray客户端请到 V2ray客户端 页面下载。</p>
<h3 id="vless协议的fallback参数">VLESS协议的fallback参数<a hidden class="anchor" aria-hidden="true" href="#vless协议的fallback参数">#</a></h3>
<p>VLESS协议 中的 <code>fallback</code> 是可选的，只能用于TLS或XTLS模式下。其值是一个对象数组，每一个对象格式如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;alpn&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;path&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;dest&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;xver&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>四个参数中只有 <code>dest</code> 是必须的，<code>alpn</code>一般不用管（或者填<code>[&quot;http/1.1&quot;]</code>），<code>path</code> 是回落路径，<code>xver</code>用来指示是否传递真实ip信息（需要填1，不需要填0）。新手建议先忽略<code>dest</code>外的选项，例如 V2ray的VLESS协议介绍和使用教程 中，<code>fallback</code>的值为：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#e6db74">&#34;fallbacks&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> [
</span></span><span style="display:flex;"><span>  { 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;dest&#34;</span>: <span style="color:#ae81ff">80</span> <span style="color:#75715e">// 回落配置，可以直接转到其他网站，例如&#34;www.baidu.com:80&#34; 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  } 
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><p>如果有多组转发，则可按照 <code>pat</code>h 路径配置多组 <code>fallback</code> 对象，例如V2ray官方配置中的 VLESS终极配置 的配置如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#e6db74">&#34;fallbacks&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;dest&#34;</span>: <span style="color:#ae81ff">80</span> <span style="color:#75715e">// 或者回落到其它也防探测的代理
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;path&#34;</span>: <span style="color:#e6db74">&#34;/websocket&#34;</span>, <span style="color:#75715e">// 必须换成自定义的 PATH
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#f92672">&#34;dest&#34;</span>: <span style="color:#ae81ff">1234</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;xver&#34;</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;path&#34;</span>: <span style="color:#e6db74">&#34;/vmesstcp&#34;</span>, <span style="color:#75715e">// 必须换成自定义的 PATH
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#f92672">&#34;dest&#34;</span>: <span style="color:#ae81ff">2345</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;xver&#34;</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;path&#34;</span>: <span style="color:#e6db74">&#34;/vmessws&#34;</span>, <span style="color:#75715e">// 必须换成自定义的 PATH
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#f92672">&#34;dest&#34;</span>: <span style="color:#ae81ff">3456</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;xver&#34;</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><p>在上述配置中，客户端请求 <code>域名:/websocket</code> 时，流量将转发到本机的1234端口；请求 <code>域名:/vmesstcp</code> 时，流量转发到本机的 2345 端口；请求<code>路径为 /vmessws</code> 时转发到 3456 端口；如果是其他请求，则转到到 80 端口。</p>
<h3 id="配置vless-fallback可能遇到的问题">配置VLESS fallback可能遇到的问题<a hidden class="anchor" aria-hidden="true" href="#配置vless-fallback可能遇到的问题">#</a></h3>
<p>从上面可以看到，VLESS协议 的回落按照 <code>path</code> 区分，和Nginx按照域名区分是不同的。于是新手可能会产生如下问题：</p>
<blockquote>
<p>服务器上多个域名，fallback怎么配置？</p>
</blockquote>
<p>V2ray的VLESS协议 的入栈配置按照 path/alpn等参数选择回落，不能根据域名（SNI）分流。如果要支持多域名共存，请使用如下方案：</p>
<ul>
<li>v2ray监听非443端口（例如监听8443），Nginx监听443端口，然后v2ray fallback到Nginx的80端口；</li>
<li>Nginx使用stream监听443，然后根据域名SNI分流，流量转到后端网站以及V2ray。</li>
</ul>
<p>如果你不在意v2ray的流量入口不是443端口，建议使用第一种方案，无需对现在站点配置做改动；否则请选择第二种方案。</p>
<blockquote>
<p>2021.1.15更新：Xray-core 1.2.2版本fallback新增name参数，可填入域名实现SNI分流</p>
</blockquote>
<h3 id="vless-alpn问题">VLESS ALPN问题<a hidden class="anchor" aria-hidden="true" href="#vless-alpn问题">#</a></h3>
<p>如果fallback后端用的Nginx，fallback时会遇到问题。具体为：</p>
<ol>
<li>
<p>如果V2ray (x)tlsSettings 不指定ALPN，根据测试V2ray只接受HTTP/2协议，流量fallback到后端时将采用的 h2c 协议。此时，后端Nginx必须用h2c的HTTP/2配置才能正常解析请求：</p>
<pre tabindex="0"><code>listen 80 http2; # h2c协议，无需配置ssl证书
</code></pre><p>需要注意的是，这种情况下，浏览器用HTTP协议不能正常访问80端口，因为HTTP/2规定必须使用HTTPS。</p>
</li>
<li>
<p>为解决上述情形，V2ray <code>(x)tlsSettings</code>可以指定<code>ALPN</code>为<code>HTTP/1.1</code>：</p>
<pre tabindex="0"><code> tlsSettings: {
     &#34;serverName&#34;: &#34;xxx.com&#34;,
     &#34;alpn&#34;: [&#34;http/1.1&#34;],
     ...
 }
</code></pre><p>如此一来，V2ray将通过HTTP/1.1协议转发流量到Nginx，Nginx常规监听80端口即可，浏览器用HTTP/1.1协议也能直接访问：</p>
<pre tabindex="0"><code>server {
     listen 80;
     ...
}
</code></pre><p>这种配置的问题是不支持更高性能的HTTP/2协议，如果后端是网站，对访客访问速度会有影响。</p>
</li>
<li>
<p>对于配合建站的V2ray伪装来说，我们希望流量是正常的，用户能尽快打开网页，同时兼容性也好。在VLESS fallback模式下，即同时支持HTTP/1.1和HTTP/2。要做到如此，则需要用到VLESS fallback中的alpn参数。</p>
<p>首先，我们要让位于前端的V2ray同时支持HTTP/1.1和HTTP/2：</p>
<pre tabindex="0"><code> tlsSettings: {
     &#34;serverName&#34;: &#34;xxx.com&#34;,
     &#34;alpn&#34;: [&#34;http/1.1&#34;, &#34;h2&#34;],
     ...
 }
</code></pre><p>接着，在fallback配置中，根据alpn转发流量到后端：</p>
<pre tabindex="0"><code>&#34;fallbacks&#34;: [
    {
        &#34;alpn&#34;: &#34;http/1.1&#34;,
        &#34;dest&#34;: 80
    },
    {
        &#34;alpn&#34;: &#34;h2&#34;,
        &#34;dest&#34;: 81,
    }
]
</code></pre><p>最后，配置Nginx同时接收HTTP/1.1和H2C流量：</p>
<pre tabindex="0"><code>server {
    listen 80;
    listen 81 http2;
    ...
}
</code></pre><p>上述配置将支持所有类型流量，并且普通用户可以通过80端口正常访问网站，V2ray流量伪装做的完美而又隐蔽，是最推荐的。</p>
</li>
</ol>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://shiqstone.github.io/tags/v2ray/">v2ray</a></li>
      <li><a href="https://shiqstone.github.io/tags/xray/">xray</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="https://shiqstone.github.io">他山笨石</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
